<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥¶å¥¶å®Œæ•´å¥åº·è¨˜éŒ„ç³»çµ± - æœ€çµ‚ä¿®å¾©ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", "SimHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            font-size: 16px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #6c5ce7 0%, #5a4fcf 100%);
            color: white;
            text-align: center;
            padding: 25px 20px;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #ddd;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 10px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #6c5ce7;
            border-bottom: 3px solid #6c5ce7;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* æ•¸æ“šè¼¸å…¥å€ */
        .input-sections {
            display: grid;
            gap: 20px;
        }
        
        .section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
        }
        
        .section-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #6c5ce7;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #6c5ce7;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .form-group {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #6c5ce7;
        }
        
        .reference-range {
            font-size: 0.75em;
            color: #666;
            margin-top: 2px;
        }
        
        .big-button {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px 0;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
        }
        
        .big-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        
        /* åœ–è¡¨å€åŸŸ */
        .chart-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .chart-controls select, .chart-controls button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .chart-controls button {
            background: #6c5ce7;
            color: white;
            border-color: #6c5ce7;
            cursor: pointer;
        }
        
        .chart-controls button:hover {
            background: #5a4fcf;
        }
        
        .chart-container {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            height: 450px;
            position: relative;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .test-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .test-btn:hover {
            border-color: #6c5ce7;
            color: #6c5ce7;
            transform: translateY(-1px);
        }
        
        .test-btn.active {
            background: #6c5ce7;
            color: white;
            border-color: #6c5ce7;
            box-shadow: 0 3px 10px rgba(108, 92, 231, 0.3);
        }
        
        /* è¨˜éŒ„é¡¯ç¤º */
        .record-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .record-date {
            font-size: 1.1em;
            font-weight: bold;
            color: #6c5ce7;
            margin-bottom: 10px;
            text-align: center;
            background: white;
            padding: 8px;
            border-radius: 6px;
        }
        
        .record-values {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
        }
        
        .record-item {
            background: white;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .record-item-name {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 3px;
        }
        
        .record-item-value {
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .value-normal { color: #00b894; }
        .value-high { color: #e17055; }
        .value-low { color: #fdcb6e; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .stat-card h3 {
            color: #6c5ce7;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .success-message {
            background: #d4edda;
            border: 2px solid #00b894;
            color: #00b894;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
            display: none;
        }
        
        .alert {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            border: 2px solid;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-color: #74b9ff;
            color: #0c5460;
        }
        
        .search-box {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #6c5ce7;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .record-values {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ å¥¶å¥¶å®Œæ•´å¥åº·è¨˜éŒ„ç³»çµ±</h1>
            <p>åŒ…å«å®Œæ•´æª¢é©—æŒ‡æ¨™ â€¢ å°ˆæ¥­è¨˜éŒ„ â€¢ è¶¨å‹¢åˆ†æ â€¢ æ™ºèƒ½é è­¦ â€¢ æœ€çµ‚ä¿®å¾©ç‰ˆ</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('input')">ğŸ“ æ·»åŠ è¨˜éŒ„</button>
            <button class="tab" onclick="showTab('charts')">ğŸ“Š åœ–è¡¨åˆ†æ</button>
            <button class="tab" onclick="showTab('records')">ğŸ“‹ æ­·å²è¨˜éŒ„</button>
            <button class="tab" onclick="showTab('export')">ğŸ’¾ æ•¸æ“šç®¡ç†</button>
            <button class="tab" onclick="showTab('summary')">ğŸ“ˆ å¥åº·ç¸½è¦½</button>
        </div>
        
        <!-- æ·»åŠ è¨˜éŒ„æ¨™ç±¤é  -->
        <div id="input" class="tab-content active">
            <div class="form-group" style="margin-bottom: 20px;">
                <label for="testDate">ğŸ“… æª¢æŸ¥æ—¥æœŸ</label>
                <input type="date" id="testDate" required>
            </div>
            
            <div class="input-sections">
                <!-- åŸºç¤ä»£è¬æŒ‡æ¨™ -->
                <div class="section">
                    <div class="section-title">ğŸ¬ åŸºç¤ä»£è¬æŒ‡æ¨™</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="glucose">è‘¡è„ç³–</label>
                            <input type="number" id="glucose" step="0.1" placeholder="5.7">
                            <div class="reference-range">æ­£å¸¸ï¼š3.90-6.10 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="lactate">ä¹³é…¸æ¿ƒåº¦</label>
                            <input type="number" id="lactate" step="0.1" placeholder="1.2">
                            <div class="reference-range">æ­£å¸¸ï¼š0.5-1.6 mmol/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- è‚åŠŸèƒ½æŒ‡æ¨™ -->
                <div class="section">
                    <div class="section-title">ğŸ«€ è‚åŠŸèƒ½æŒ‡æ¨™</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="gpt">ä¸™æ°¨é…¸æ°¨åŸºè½‰ç§»é…¶(GPT)</label>
                            <input type="number" id="gpt" step="1" placeholder="29">
                            <div class="reference-range">æ­£å¸¸ï¼š7-40 U/L</div>
                        </div>
                        <div class="form-group">
                            <label for="got">å¤©é–€å†¬æ°¨é…¸æ°¨åŸºè½‰ç§»é…¶(GOT)</label>
                            <input type="number" id="got" step="1" placeholder="43">
                            <div class="reference-range">æ­£å¸¸ï¼š13-35 U/L</div>
                        </div>
                        <div class="form-group">
                            <label for="gotMito">GOTç·šç²’é«”åŒå·¥é…¶</label>
                            <input type="number" id="gotMito" step="1" placeholder="6">
                            <div class="reference-range">æ­£å¸¸ï¼š1-15 U/L</div>
                        </div>
                        <div class="form-group">
                            <label for="alp">é¹¼æ€§ç£·é…¸é…¶</label>
                            <input type="number" id="alp" step="1" placeholder="252">
                            <div class="reference-range">æ­£å¸¸ï¼š50-135 U/L</div>
                        </div>
                        <div class="form-group">
                            <label for="ggt">Î³-è°·æ°¨é†¯åŸºè½‰ç§»é…¶</label>
                            <input type="number" id="ggt" step="1" placeholder="56">
                            <div class="reference-range">æ­£å¸¸ï¼š7-45 U/L</div>
                        </div>
                        <div class="form-group">
                            <label for="ldh">ä¹³é…¸è„«æ°«é…¶</label>
                            <input type="number" id="ldh" step="1" placeholder="180">
                            <div class="reference-range">æ­£å¸¸ï¼š120-250 U/L</div>
                        </div>
                        <div class="form-group">
                            <label for="gsr">è°·èƒ±ç”˜è‚½é‚„åŸé…¶</label>
                            <input type="number" id="gsr" step="1" placeholder="50">
                            <div class="reference-range">æ­£å¸¸ï¼š33-74 U/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- è†½ç´…ç´ æŒ‡æ¨™ -->
                <div class="section">
                    <div class="section-title">ğŸŸ¡ è†½ç´…ç´ æŒ‡æ¨™</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="bilirubin">ç¸½è†½ç´…ç´ </label>
                            <input type="number" id="bilirubin" step="0.1" placeholder="33.0">
                            <div class="reference-range">æ­£å¸¸ï¼š4.7-24 Î¼mol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="directBilirubin">ç›´æ¥è†½ç´…ç´ </label>
                            <input type="number" id="directBilirubin" step="0.1" placeholder="16.0">
                            <div class="reference-range">æ­£å¸¸ï¼š0-6.8 Î¼mol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="bileAcid">è†½æ±é…¸</label>
                            <input type="number" id="bileAcid" step="0.1" placeholder="5.5">
                            <div class="reference-range">æ­£å¸¸ï¼š1.0-10.0 Î¼mol/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- è›‹ç™½è³ªæŒ‡æ¨™ -->
                <div class="section">
                    <div class="section-title">ğŸ¥› è›‹ç™½è³ªæŒ‡æ¨™</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="totalProtein">ç¸½è›‹ç™½</label>
                            <input type="number" id="totalProtein" step="0.1" placeholder="70">
                            <div class="reference-range">æ­£å¸¸ï¼š60-83 g/L</div>
                        </div>
                        <div class="form-group">
                            <label for="albumin">ç™½è›‹ç™½</label>
                            <input type="number" id="albumin" step="0.1" placeholder="42">
                            <div class="reference-range">æ­£å¸¸ï¼š35-55 g/L</div>
                        </div>
                        <div class="form-group">
                            <label for="albGlobRatio">ç™½çƒæ¯”ä¾‹</label>
                            <input type="number" id="albGlobRatio" step="0.1" placeholder="1.8">
                            <div class="reference-range">æ­£å¸¸ï¼š1.25-2.50</div>
                        </div>
                    </div>
                </div>
                
                <!-- è…åŠŸèƒ½æŒ‡æ¨™ -->
                <div class="section">
                    <div class="section-title">ğŸ§ª è…åŠŸèƒ½æŒ‡æ¨™</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="urea">å°¿ç´ </label>
                            <input type="number" id="urea" step="0.1" placeholder="5.8">
                            <div class="reference-range">æ­£å¸¸ï¼š2.5-7.1 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="creatinine">è‚Œé…</label>
                            <input type="number" id="creatinine" step="1" placeholder="75">
                            <div class="reference-range">æ­£å¸¸ï¼š53-97 Î¼mol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="uricAcid">å°¿é…¸</label>
                            <input type="number" id="uricAcid" step="1" placeholder="256">
                            <div class="reference-range">æ­£å¸¸ï¼š155-357 Î¼mol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="cystatinC">èƒ±æŠ‘ç´ C</label>
                            <input type="number" id="cystatinC" step="0.01" placeholder="0.81">
                            <div class="reference-range">æ­£å¸¸ï¼š0.55-1.07 mg/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- é›»è§£è³ªæŒ‡æ¨™ -->
                <div class="section">
                    <div class="section-title">âš¡ é›»è§£è³ªæŒ‡æ¨™</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="sodium">éˆ‰</label>
                            <input type="number" id="sodium" step="0.1" placeholder="141">
                            <div class="reference-range">æ­£å¸¸ï¼š136-146 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="potassium">é‰€</label>
                            <input type="number" id="potassium" step="0.1" placeholder="3.8">
                            <div class="reference-range">æ­£å¸¸ï¼š3.20-4.50 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="chloride">æ°¯</label>
                            <input type="number" id="chloride" step="0.1" placeholder="103">
                            <div class="reference-range">æ­£å¸¸ï¼š99-106 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="co2">äºŒæ°§åŒ–ç¢³</label>
                            <input type="number" id="co2" step="0.1" placeholder="26">
                            <div class="reference-range">æ­£å¸¸ï¼š21.0-31.0 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="calcium">éˆ£</label>
                            <input type="number" id="calcium" step="0.01" placeholder="1.15">
                            <div class="reference-range">æ­£å¸¸ï¼š1.15-1.16 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="phosphorus">ç£·</label>
                            <input type="number" id="phosphorus" step="0.01" placeholder="1.18">
                            <div class="reference-range">æ­£å¸¸ï¼š0.85-1.51 mmol/L</div>
                        </div>
                        <div class="form-group">
                            <label for="magnesium">è¡€æ¸…é‚</label>
                            <input type="number" id="magnesium" step="0.01" placeholder="0.89">
                            <div class="reference-range">æ­£å¸¸ï¼š0.75-1.02 mmol/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- å¿ƒè‚Œæ¨™èªŒç‰© -->
                <div class="section">
                    <div class="section-title">â¤ï¸ å¿ƒè‚Œæ¨™èªŒç‰©</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="ck">è‚Œé…¸æ¿€é…¶</label>
                            <input type="number" id="ck" step="1" placeholder="145">
                            <div class="reference-range">æ­£å¸¸ï¼š22-269 U/L</div>
                        </div>
                        <div class="form-group">
                            <label for="hfabp">å¿ƒå‹è„‚è‚ªé…¸çµåˆè›‹ç™½</label>
                            <input type="number" id="hfabp" step="0.1" placeholder="2.5">
                            <div class="reference-range">æ­£å¸¸ï¼š0-5 ng/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="ckmb">CK-MBè³ªé‡</label>
                            <input type="number" id="ckmb" step="0.1" placeholder="2.1">
                            <div class="reference-range">æ­£å¸¸ï¼š0.3-4 ng/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="myoglobin">è‚Œç´…è›‹ç™½å®šé‡</label>
                            <input type="number" id="myoglobin" step="1" placeholder="45">
                            <div class="reference-range">æ­£å¸¸ï¼š<70 ng/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="troponin">é«˜æ•è‚Œéˆ£è›‹ç™½</label>
                            <input type="number" id="troponin" step="0.1" placeholder="15">
                            <div class="reference-range">æ­£å¸¸ï¼š<30 ng/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- å…¶ä»–é…¶é¡ -->
                <div class="section">
                    <div class="section-title">ğŸ”¬ å…¶ä»–é…¶é¡</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="amylase">æ¾±ç²‰é…¶</label>
                            <input type="number" id="amylase" step="1" placeholder="85">
                            <div class="reference-range">æ­£å¸¸ï¼š35-135 U/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- ç‚ç—‡æ¨™èªŒç‰© -->
                <div class="section">
                    <div class="section-title">ğŸ”¥ ç‚ç—‡æ¨™èªŒç‰© (ç™½ä»‹ç´ )</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="il2">ç™½ä»‹ç´ 2</label>
                            <input type="number" id="il2" step="0.1" placeholder="3.7">
                            <div class="reference-range">æ­£å¸¸ï¼š<7.5 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il4">ç™½ä»‹ç´ 4</label>
                            <input type="number" id="il4" step="0.1" placeholder="4.3">
                            <div class="reference-range">æ­£å¸¸ï¼š<8.6 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il5">ç™½ä»‹ç´ 5</label>
                            <input type="number" id="il5" step="0.1" placeholder="1.5">
                            <div class="reference-range">æ­£å¸¸ï¼š<3.1 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il6">ç™½ä»‹ç´ 6</label>
                            <input type="number" id="il6" step="0.1" placeholder="2.7">
                            <div class="reference-range">æ­£å¸¸ï¼š<5.4 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il8">ç™½ä»‹ç´ 8</label>
                            <input type="number" id="il8" step="0.1" placeholder="10.3">
                            <div class="reference-range">æ­£å¸¸ï¼š<20.6 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il10">ç™½ä»‹ç´ 10</label>
                            <input type="number" id="il10" step="0.1" placeholder="6.4">
                            <div class="reference-range">æ­£å¸¸ï¼š<12.9 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il1b">ç™½ä»‹ç´ 1B</label>
                            <input type="number" id="il1b" step="0.1" placeholder="6.2">
                            <div class="reference-range">æ­£å¸¸ï¼š<12.4 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il12">ç™½ä»‹ç´ 12p70</label>
                            <input type="number" id="il12" step="0.1" placeholder="1.7">
                            <div class="reference-range">æ­£å¸¸ï¼š<3.4 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="il17">ç™½ä»‹ç´ 17</label>
                            <input type="number" id="il17" step="0.1" placeholder="10.7">
                            <div class="reference-range">æ­£å¸¸ï¼š<21.4 pg/mL</div>
                        </div>
                        <div class="form-group">
                            <label for="tnfa">è…«ç˜¤å£æ­»å› å­Î±</label>
                            <input type="number" id="tnfa" step="0.1" placeholder="8.2">
                            <div class="reference-range">æ­£å¸¸ï¼š<16.5 pg/mL</div>
                        </div>
                    </div>
                </div>
                
                <!-- å‡è¡€åŠŸèƒ½ -->
                <div class="section">
                    <div class="section-title">ğŸ©¸ å‡è¡€åŠŸèƒ½</div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="aptt">APTT</label>
                            <input type="number" id="aptt" step="0.1" placeholder="30.5">
                            <div class="reference-range">æ­£å¸¸ï¼š22.3-38.7 ç§’</div>
                        </div>
                        <div class="form-group">
                            <label for="pt">PT</label>
                            <input type="number" id="pt" step="0.1" placeholder="13.0">
                            <div class="reference-range">æ­£å¸¸ï¼š10.0-16.0 ç§’</div>
                        </div>
                        <div class="form-group">
                            <label for="tt">TT</label>
                            <input type="number" id="tt" step="0.1" placeholder="17.5">
                            <div class="reference-range">æ­£å¸¸ï¼š14.00-21.00 ç§’</div>
                        </div>
                        <div class="form-group">
                            <label for="fg">Fg</label>
                            <input type="number" id="fg" step="0.1" placeholder="2.6">
                            <div class="reference-range">æ­£å¸¸ï¼š1.8-3.5 g/L</div>
                        </div>
                    </div>
                </div>
                
                <!-- å‚™è¨» -->
                <div class="section">
                    <div class="section-title">ğŸ“ å‚™è¨»ä¿¡æ¯</div>
                    <div class="form-group">
                        <label for="notes">å‚™è¨»</label>
                        <input type="text" id="notes" placeholder="å¯å¡«å¯«ï¼šé†«ç”Ÿå»ºè­°ã€èº«é«”æ„Ÿè¦ºã€ç”¨è—¥æƒ…æ³ç­‰">
                    </div>
                </div>
            </div>
            
            <div class="success-message" id="successMessage">
                âœ… è¨˜éŒ„ä¿å­˜æˆåŠŸï¼æ•¸æ“šå·²åŒæ­¥åˆ°æ‰€æœ‰æ¨™ç±¤é ï¼
            </div>
            
            <button class="big-button btn-primary" onclick="saveRecord()">ğŸ’¾ ä¿å­˜ä»Šå¤©çš„è¨˜éŒ„</button>
            <button class="big-button btn-secondary" onclick="loadLatestData()">ğŸ“Š åŠ è¼‰æœ€æ–°æ•¸æ“šæ¨¡æ¿</button>
            <button class="big-button btn-danger" onclick="clearCurrentForm()">ğŸ—‘ï¸ æ¸…ç©ºç•¶å‰è¼¸å…¥</button>
        </div>
        
        <!-- åœ–è¡¨åˆ†ææ¨™ç±¤é  -->
        <div id="charts" class="tab-content">
            <h2 style="margin-bottom: 15px; color: #2d3436;">ğŸ“Š å¥åº·è¶¨å‹¢åœ–è¡¨åˆ†æ</h2>
            
            <!-- æ•¸æ“šçµ±è¨ˆä¿¡æ¯ -->
            <div class="alert alert-info" style="margin-bottom: 15px;">
                <strong>ğŸ“ˆ æ•¸æ“šçµ±è¨ˆï¼š</strong>
                <span id="dataStatsInfo">æ­£åœ¨åŠ è¼‰æ•¸æ“šçµ±è¨ˆ...</span>
            </div>
            
            <input type="text" class="search-box" id="chartSearch" placeholder="ğŸ” æœç´¢æª¢é©—é …ç›®..." onkeyup="filterChartButtons()">
            
            <div class="chart-controls">
                <label><strong>é¸æ“‡æª¢é©—é …ç›®ï¼š</strong></label>
                <select id="chartType" onchange="updateChart()">
                    <!-- å°‡é€šéJavaScriptå‹•æ…‹å¡«å…… -->
                </select>
                
                <label><strong>åœ–è¡¨é¡å‹ï¼š</strong></label>
                <select id="chartStyle" onchange="updateChart()">
                    <option value="line">æŠ˜ç·šåœ–</option>
                    <option value="bar" selected>æŸ±ç‹€åœ–</option>
                </select>
                
                <select id="dataRange" onchange="updateChart()">
                    <option value="10">æœ€è¿‘10æ¬¡</option>
                    <option value="20" selected>æœ€è¿‘20æ¬¡</option>
                    <option value="all">å…¨éƒ¨æ•¸æ“š</option>
                </select>
                
                <button onclick="updateChart()">ğŸ”„ åˆ·æ–°åœ–è¡¨</button>
                <button onclick="showMultiChart()">ğŸ“ˆ å¤šé …å°æ¯”</button>
                <button onclick="exportChart()">ğŸ“Š å°å‡ºåœ–è¡¨</button>
            </div>
            
            <div class="test-buttons" id="testButtons">
                <!-- æŒ‰éˆ•å°‡é€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <div class="chart-container">
                <canvas id="trendChart"></canvas>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>æœ€æ–°æ•¸å€¼</h3>
                    <div class="stat-value" id="latestValue">-</div>
                </div>
                <div class="stat-card">
                    <h3>å¹³å‡å€¼</h3>
                    <div class="stat-value" id="averageValue">-</div>
                </div>
                <div class="stat-card">
                    <h3>æœ€é«˜å€¼</h3>
                    <div class="stat-value" id="maxValue">-</div>
                </div>
                <div class="stat-card">
                    <h3>æœ€ä½å€¼</h3>
                    <div class="stat-value" id="minValue">-</div>
                </div>
                <div class="stat-card">
                    <h3>è¨˜éŒ„æ•¸é‡</h3>
                    <div class="stat-value" id="recordCount">-</div>
                </div>
                <div class="stat-card">
                    <h3>è¶¨å‹¢åˆ†æ</h3>
                    <div class="stat-value" id="trendAnalysis">-</div>
                </div>
            </div>
        </div>
        
        <!-- æ­·å²è¨˜éŒ„æ¨™ç±¤é  -->
        <div id="records" class="tab-content">
            <h2 style="margin-bottom: 15px; color: #2d3436;">ğŸ“‹ å®Œæ•´æ­·å²è¨˜éŒ„</h2>
            
            <div class="alert alert-info">
                <strong>ğŸ“Š è¨˜éŒ„çµ±è¨ˆï¼š</strong>
                å…±æœ‰ <span id="totalRecords">0</span> æ¢è¨˜éŒ„ï¼Œ
                æ™‚é–“è·¨åº¦ï¼š<span id="dateRange">-</span>
            </div>
            
            <input type="text" class="search-box" id="recordSearch" placeholder="ğŸ” æœç´¢è¨˜éŒ„ï¼ˆæŒ‰æ—¥æœŸã€æ•¸å€¼æˆ–å‚™è¨»ï¼‰..." onkeyup="filterRecords()">
            
            <div class="records-grid" id="recordsList">
                <!-- è¨˜éŒ„å°‡é€šéJavaScriptå‹•æ…‹æ·»åŠ  -->
            </div>
        </div>
        
        <!-- æ•¸æ“šç®¡ç†æ¨™ç±¤é  -->
        <div id="export" class="tab-content">
            <h2 style="margin-bottom: 15px; color: #2d3436;">ğŸ’¾ æ•¸æ“šå°å…¥å°å‡º</h2>
            
            <div class="section">
                <div class="section-title">ğŸ“¤ æ•¸æ“šå°å‡º</div>
                <button class="big-button btn-secondary" onclick="exportToExcel()">ğŸ“Š å°å‡ºç‚ºExcelæ–‡ä»¶(.xlsx)</button>
                <button class="big-button btn-secondary" onclick="exportToCSV()">ğŸ“„ å°å‡ºç‚ºCSVæ–‡ä»¶</button>
                <button class="big-button btn-secondary" onclick="exportToJSON()">ğŸ’¾ å°å‡ºç‚ºJSONæ–‡ä»¶</button>
                <button class="big-button btn-secondary" onclick="copyToClipboard()">ğŸ“‹ è¤‡è£½æ•¸æ“šåˆ°å‰ªè²¼æ¿</button>
            </div>
            
            <div class="section">
                <div class="section-title">ğŸ“¥ æ•¸æ“šå°å…¥</div>
                <input type="file" id="fileInput" accept=".json,.csv,.xlsx" style="margin-bottom: 10px;">
                <button class="big-button btn-primary" onclick="importData()">ğŸ“ å°å…¥æ•¸æ“šæ–‡ä»¶</button>
                <button class="big-button btn-secondary" onclick="loadPreloadedData()">ğŸ”„ æ¢å¾©çœŸå¯¦æ•¸æ“š</button>
            </div>
            
            <div class="section">
                <div class="section-title">ğŸ—‘ï¸ æ•¸æ“šç®¡ç†</div>
                <button class="big-button btn-danger" onclick="clearAllData()">âš ï¸ æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„</button>
                <button class="big-button btn-secondary" onclick="backupData()">ğŸ’¿ å‰µå»ºæ•¸æ“šå‚™ä»½</button>
            </div>
            
            <div class="alert alert-info">
                <strong>ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</strong>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>æ•¸æ“šè‡ªå‹•ä¿å­˜åœ¨ç€è¦½å™¨æœ¬åœ°å­˜å„²ä¸­</li>
                    <li>å»ºè­°å®šæœŸå°å‡ºå‚™ä»½é‡è¦æ•¸æ“š</li>
                    <li>æ¸…ç©ºæ•¸æ“šæ“ä½œä¸å¯æ¢å¾©ï¼Œè«‹è¬¹æ…æ“ä½œ</li>
                    <li>æ›´æ›è¨­å‚™æ™‚è«‹å…ˆå°å‡ºæ•¸æ“šå†å°å…¥</li>
                    <li>Excelæ ¼å¼æœ€é©åˆèˆ‡é†«ç”Ÿåˆ†äº«å’Œæ‰“å°</li>
                </ul>
            </div>
        </div>
        
        <!-- å¥åº·ç¸½è¦½æ¨™ç±¤é  -->
        <div id="summary" class="tab-content">
            <h2 style="margin-bottom: 15px; color: #2d3436;">ğŸ“ˆ å¥åº·ç‹€æ³ç¸½è¦½</h2>
            
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <h3>ç¸½è¨˜éŒ„æ•¸</h3>
                    <div class="stat-value" id="summaryTotalRecords">-</div>
                </div>
                <div class="stat-card">
                    <h3>ç›£æ¸¬å¤©æ•¸</h3>
                    <div class="stat-value" id="summaryDays">-</div>
                </div>
                <div class="stat-card">
                    <h3>ç•°å¸¸æŒ‡æ¨™æ•¸</h3>
                    <div class="stat-value" id="summaryAbnormal" style="color: #e17055;">-</div>
                </div>
                <div class="stat-card">
                    <h3>æ­£å¸¸æŒ‡æ¨™æ•¸</h3>
                    <div class="stat-value" id="summaryNormal" style="color: #00b894;">-</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">ğŸ” æœ€æ–°æª¢é©—çµæœåˆ†æ</div>
                <div id="latestAnalysis" style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                    æ­£åœ¨åˆ†ææœ€æ–°æª¢é©—çµæœ...
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">ğŸ“Š ä¸»è¦æŒ‡æ¨™è¶¨å‹¢</div>
                <div id="trendSummary" style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                    æ­£åœ¨åˆ†æè¶¨å‹¢...
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">âš ï¸ é‡é»é—œæ³¨é …ç›®</div>
                <div id="alertItems" style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                    æ­£åœ¨åˆ†æé‡é»é—œæ³¨é …ç›®...
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®Œæ•´çš„æª¢é©—é …ç›®é…ç½®
        const testConfigs = {
            glucose: { name: 'è‘¡è„ç³–', unit: 'mmol/L', min: 3.9, max: 6.1 },
            gpt: { name: 'GPT', unit: 'U/L', min: 7, max: 40 },
            got: { name: 'GOT', unit: 'U/L', min: 13, max: 35 },
            gotMito: { name: 'GOTç·šç²’é«”åŒå·¥é…¶', unit: 'U/L', min: 1, max: 15 },
            alp: { name: 'é¹¼æ€§ç£·é…¸é…¶', unit: 'U/L', min: 50, max: 135 },
            ggt: { name: 'Î³-è°·æ°¨é†¯åŸºè½‰ç§»é…¶', unit: 'U/L', min: 7, max: 45 },
            bilirubin: { name: 'ç¸½è†½ç´…ç´ ', unit: 'Î¼mol/L', min: 4.7, max: 24 },
            directBilirubin: { name: 'ç›´æ¥è†½ç´…ç´ ', unit: 'Î¼mol/L', min: 0, max: 6.8 },
            totalProtein: { name: 'ç¸½è›‹ç™½', unit: 'g/L', min: 60, max: 83 },
            albumin: { name: 'ç™½è›‹ç™½', unit: 'g/L', min: 35, max: 55 },
            albGlobRatio: { name: 'ç™½çƒæ¯”ä¾‹', unit: '', min: 1.25, max: 2.5 },
            bileAcid: { name: 'è†½æ±é…¸', unit: 'Î¼mol/L', min: 1.0, max: 10.0 },
            urea: { name: 'å°¿ç´ ', unit: 'mmol/L', min: 2.5, max: 7.1 },
            creatinine: { name: 'è‚Œé…', unit: 'Î¼mol/L', min: 53, max: 97 },
            uricAcid: { name: 'å°¿é…¸', unit: 'Î¼mol/L', min: 155, max: 357 },
            sodium: { name: 'éˆ‰', unit: 'mmol/L', min: 136, max: 146 },
            potassium: { name: 'é‰€', unit: 'mmol/L', min: 3.2, max: 4.5 },
            chloride: { name: 'æ°¯', unit: 'mmol/L', min: 99, max: 106 },
            co2: { name: 'äºŒæ°§åŒ–ç¢³', unit: 'mmol/L', min: 21.0, max: 31.0 },
            calcium: { name: 'éˆ£', unit: 'mmol/L', min: 1.15, max: 1.16 },
            phosphorus: { name: 'ç£·', unit: 'mmol/L', min: 0.85, max: 1.51 },
            magnesium: { name: 'è¡€æ¸…é‚', unit: 'mmol/L', min: 0.75, max: 1.02 },
            cystatinC: { name: 'èƒ±æŠ‘ç´ C', unit: 'mg/L', min: 0.55, max: 1.07 },
            lactate: { name: 'ä¹³é…¸æ¿ƒåº¦', unit: 'mmol/L', min: 0.5, max: 1.6 },
            ldh: { name: 'ä¹³é…¸è„«æ°«é…¶', unit: 'U/L', min: 120, max: 250 },
            ck: { name: 'è‚Œé…¸æ¿€é…¶', unit: 'U/L', min: 22, max: 269 },
            hfabp: { name: 'å¿ƒå‹è„‚è‚ªé…¸çµåˆè›‹ç™½', unit: 'ng/mL', min: 0, max: 5 },
            gsr: { name: 'è°·èƒ±ç”˜è‚½é‚„åŸé…¶', unit: 'U/L', min: 33, max: 74 },
            ckmb: { name: 'CK-MBè³ªé‡', unit: 'ng/mL', min: 0.3, max: 4 },
            myoglobin: { name: 'è‚Œç´…è›‹ç™½å®šé‡', unit: 'ng/mL', min: 0, max: 70 },
            troponin: { name: 'é«˜æ•è‚Œéˆ£è›‹ç™½', unit: 'ng/L', min: 0, max: 30 },
            amylase: { name: 'æ¾±ç²‰é…¶', unit: 'U/L', min: 35, max: 135 },
            il2: { name: 'ç™½ä»‹ç´ 2', unit: 'pg/mL', min: 0, max: 7.5 },
            il4: { name: 'ç™½ä»‹ç´ 4', unit: 'pg/mL', min: 0, max: 8.6 },
            il5: { name: 'ç™½ä»‹ç´ 5', unit: 'pg/mL', min: 0, max: 3.1 },
            il6: { name: 'ç™½ä»‹ç´ 6', unit: 'pg/mL', min: 0, max: 5.4 },
            il8: { name: 'ç™½ä»‹ç´ 8', unit: 'pg/mL', min: 0, max: 20.6 },
            il10: { name: 'ç™½ä»‹ç´ 10', unit: 'pg/mL', min: 0, max: 12.9 },
            il1b: { name: 'ç™½ä»‹ç´ 1B', unit: 'pg/mL', min: 0, max: 12.4 },
            il12: { name: 'ç™½ä»‹ç´ 12p70', unit: 'pg/mL', min: 0, max: 3.4 },
            il17: { name: 'ç™½ä»‹ç´ 17', unit: 'pg/mL', min: 0, max: 21.4 },
            tnfa: { name: 'è…«ç˜¤å£æ­»å› å­Î±', unit: 'pg/mL', min: 0, max: 16.5 },
            aptt: { name: 'APTT', unit: 'ç§’', min: 22.3, max: 38.7 },
            pt: { name: 'PT', unit: 'ç§’', min: 10.0, max: 16.0 },
            tt: { name: 'TT', unit: 'ç§’', min: 14.0, max: 21.0 },
            fg: { name: 'Fg', unit: 'g/L', min: 1.8, max: 3.5 }
        };

        // åŸºæ–¼çœŸå¯¦ç‘é‡‘å ±å‘Šçš„å®Œæ•´å¥åº·è¨˜éŒ„æ•¸æ“š - ä¿®å¾©äº†èªæ³•éŒ¯èª¤
        const preloadedHealthRecords = [
            {"date": "2025-06-26", "glucose": 5.8, "gpt": 17, "got": 23, "alp": 71, "ggt": 42, "bilirubin": 4, "directBilirubin": 4.1, "totalProtein": 54, "albumin": 118, "albGlobRatio": 2.6, "bileAcid": 5, "urea": 4.3, "creatinine": 52, "uricAcid": 46, "sodium": 134, "potassium": 5.3, "chloride": 104, "co2": 33.2, "calcium": 0.81, "lactate": 1.2, "ldh": 210, "ck": 24, "gsr": 55, "ckmb": 0.4, "myoglobin": 27.7, "troponin": 17.2, "aptt": 53.2, "pt": 14.6, "tt": 16.1, "fg": 3.3, "notes": "æœ€æ–°æª¢é©— - å„é …æŒ‡æ¨™æŒçºŒæ”¹å–„"},
            {"date": "2025-06-25", "glucose": 5.3, "gpt": 20, "got": 22, "gotMito": 6, "alp": 76, "ggt": 46, "bilirubin": 1, "directBilirubin": 2.5, "totalProtein": 52, "albumin": 136, "albGlobRatio": 2.25, "bileAcid": 8.5, "urea": 4.8, "creatinine": 49, "uricAcid": 49, "sodium": 137, "potassium": 4.2, "chloride": 105, "co2": 38.4, "calcium": 0.82, "lactate": 1.2, "ldh": 196, "ck": 19, "gsr": 55, "ckmb": 0.6, "myoglobin": 31.5, "troponin": 20.7, "aptt": 47.3, "pt": 14.4, "tt": 15.9, "fg": 3, "notes": "æª¢æŸ¥ç©©å®š"},
            {"date": "2025-06-24", "glucose": 7.2, "gpt": 24, "got": 22, "gotMito": 4, "alp": 83, "ggt": 52, "bilirubin": 0, "directBilirubin": 2.6, "totalProtein": 51, "albumin": 159, "albGlobRatio": 2.19, "bileAcid": 5.5, "urea": 4.5, "creatinine": 47, "uricAcid": 28, "sodium": 137, "potassium": 4.3, "chloride": 105, "co2": 42, "calcium": 0.83, "lactate": 1.3, "ldh": 172, "ck": 23, "gsr": 56, "ckmb": 0.8, "myoglobin": 40.2, "troponin": 10, "aptt": 94.6, "pt": 14.6, "fg": 2.5, "notes": ""},
            {"date": "2025-06-23", "glucose": 3.5, "gpt": 30, "got": 31, "gotMito": 7, "alp": 88, "ggt": 62, "bilirubin": 0, "directBilirubin": 2.7, "totalProtein": 49, "albumin": 173, "albGlobRatio": 2.27, "bileAcid": 6.5, "urea": 4.3, "creatinine": 43, "uricAcid": 24, "sodium": 138, "potassium": 4.4, "chloride": 106, "co2": 38.1, "calcium": 0.84, "magnesium": 1.09, "cystatinC": 1.28, "lactate": 1.7, "ldh": 200, "ck": 26, "gsr": 62, "ckmb": 0.9, "myoglobin": 48.4, "troponin": 9.9, "aptt": 32, "pt": 12.7, "tt": 18.4, "fg": 2.2, "notes": "è¡€ç³–åä½"},
            {"date": "2025-06-22", "glucose": 5.3, "gpt": 33, "got": 42, "gotMito": 12, "alp": 88, "ggt": 67, "bilirubin": 0, "directBilirubin": 3, "totalProtein": 46, "albumin": 174, "albGlobRatio": 2.292, "bileAcid": 11.6, "urea": 5.2, "creatinine": 40, "uricAcid": 17, "sodium": 140, "potassium": 4.9, "chloride": 111, "co2": 39.5, "calcium": 0.85, "lactate": 1.8, "ldh": 222, "ck": 28, "gsr": 58, "ckmb": 1, "myoglobin": 41.8, "troponin": 8.7, "aptt": 30, "pt": 12.5, "tt": 19.4, "fg": 1.5, "notes": ""},
            {"date": "2025-06-21", "glucose": 6.9, "gpt": 22, "got": 29, "gotMito": 6, "alp": 80, "ggt": 63, "bilirubin": 0, "directBilirubin": 2.1, "totalProtein": 44, "albumin": 163, "albGlobRatio": 2.14, "bileAcid": 5.1, "urea": 5.2, "creatinine": 38, "uricAcid": 19, "sodium": 142, "potassium": 4.1, "chloride": 112, "co2": 36, "calcium": 0.86, "lactate": 1.9, "ldh": 192, "ck": 32, "gsr": 58, "ckmb": 1.2, "myoglobin": 44.4, "troponin": 10.8, "aptt": 34.3, "pt": 12.5, "tt": 21.3, "fg": 1.3, "notes": ""},
            {"date": "2025-06-20", "glucose": 6.4, "gpt": 16, "got": 18, "gotMito": 4, "alp": 81, "ggt": 64, "bilirubin": 0, "directBilirubin": 2.2, "totalProtein": 43, "albumin": 158, "albGlobRatio": 2.58, "bileAcid": 3.3, "urea": 5.7, "creatinine": 38, "uricAcid": 22, "sodium": 140, "potassium": 3.7, "chloride": 108, "co2": 37.3, "calcium": 0.87, "lactate": 1.9, "ldh": 173, "ck": 31, "gsr": 50, "ckmb": 1, "myoglobin": 47.5, "troponin": 10.9, "aptt": 36.5, "pt": 12.2, "tt": 17.5, "fg": 1.5, "notes": ""},
            {"date": "2025-06-19", "glucose": 4.8, "gpt": 16, "got": 18, "gotMito": 4, "alp": 77, "ggt": 73, "bilirubin": 0, "directBilirubin": 1.5, "totalProtein": 42, "albumin": 151, "albGlobRatio": 2.82, "bileAcid": 2.9, "urea": 7.2, "creatinine": 41, "uricAcid": 32, "sodium": 140, "potassium": 3.8, "chloride": 106, "co2": 38.9, "calcium": 0.88, "magnesium": 1.3, "cystatinC": 1.34, "lactate": 1.9, "ldh": 167, "ck": 29, "gsr": 52, "ckmb": 1.1, "myoglobin": 63.8, "troponin": 11, "il2": 2.4, "il5": 7.2, "il6": 38, "il8": 10.2, "il10": 3, "aptt": 86.8, "pt": 12.5, "tt": 60, "fg": 1.3, "notes": "è¡€ç³–æ­£å¸¸"},
            {"date": "2025-06-18", "gpt": 17, "got": 14, "gotMito": 2, "alp": 71, "ggt": 74, "bilirubin": 0, "directBilirubin": 2.9, "totalProtein": 46, "albumin": 130, "albGlobRatio": 2.29, "bileAcid": 3.3, "urea": 7.8, "creatinine": 43, "uricAcid": 39, "calcium": 0.89, "lactate": 0.5, "ldh": 159, "ck": 26, "gsr": 53, "ckmb": 1, "myoglobin": 70.3, "troponin": 10.3, "aptt": 38.4, "pt": 12.3, "tt": 16.9, "fg": 1.6, "notes": "æœªæŸ¥è¡€ç³–"},
            {"date": "2025-06-17", "glucose": 7.7, "gpt": 17, "got": 15, "gotMito": 2, "alp": 73, "ggt": 85, "bilirubin": 1, "directBilirubin": 2.9, "totalProtein": 45, "albumin": 124, "albGlobRatio": 2, "bileAcid": 2.7, "urea": 8.1, "creatinine": 48, "uricAcid": 48, "sodium": 140, "potassium": 3.6, "chloride": 105, "co2": 38.8, "calcium": 0.9, "lactate": 1.7, "ldh": 136, "ck": 20, "gsr": 52, "ckmb": 0.6, "myoglobin": 83, "troponin": 9.1, "aptt": 46.4, "pt": 13.8, "tt": 17.1, "fg": 1.8, "notes": ""},
            {"date": "2025-06-16", "glucose": 8.2, "gpt": 25, "got": 19, "gotMito": 4, "alp": 100, "ggt": 136, "bilirubin": 1, "directBilirubin": 2.2, "totalProtein": 53, "albumin": 163, "albGlobRatio": 1.94, "bileAcid": 1.9, "urea": 8.3, "creatinine": 49, "uricAcid": 80, "sodium": 147, "potassium": 3.6, "chloride": 106, "co2": 37.9, "calcium": 0.91, "magnesium": 1.01, "cystatinC": 2.02, "lactate": 3.1, "ldh": 184, "ck": 37, "gsr": 60, "ckmb": 1, "myoglobin": 97.8, "troponin": 13.2, "aptt": 30.5, "pt": 12.5, "tt": 19.7, "fg": 1.7, "notes": ""},
            {"date": "2025-06-15", "glucose": 9, "sodium": 147, "potassium": 2.9, "chloride": 116, "co2": 29.5, "lactate": 2.5, "notes": ""},
            {"date": "2025-06-14", "glucose": 10.8, "gpt": 35, "got": 19, "gotMito": 4, "alp": 129, "ggt": 193, "bilirubin": 1, "directBilirubin": 4.8, "totalProtein": 51, "albumin": 102, "albGlobRatio": 1.68, "bileAcid": 1.2, "urea": 10.2, "creatinine": 56, "uricAcid": 200, "sodium": 146, "potassium": 3.4, "chloride": 110, "co2": 35.8, "calcium": 0.93, "lactate": 1.2, "ldh": 180, "ck": 46, "gsr": 64, "ckmb": 3.2, "myoglobin": 180.4, "troponin": 15.1, "aptt": 53.5, "pt": 13.9, "tt": 39.7, "fg": 3, "notes": ""},
            {"date": "2025-06-13", "glucose": 7.8, "gpt": 50, "got": 23, "gotMito": 4, "alp": 165, "ggt": 250, "bilirubin": 6, "directBilirubin": 4.1, "totalProtein": 53, "albumin": 71, "albGlobRatio": 1.65, "bileAcid": 1.6, "urea": 9.4, "creatinine": 58, "uricAcid": 190, "sodium": 142, "potassium": 4, "chloride": 109, "co2": 35.2, "calcium": 0.94, "lactate": 1.2, "ldh": 165, "ck": 46, "gsr": 70, "ckmb": 2.9, "myoglobin": 178.5, "troponin": 21.6, "aptt": 34.7, "pt": 12.9, "tt": 17, "fg": 4.2, "notes": "æŒçºŒæ”¹å–„"},
            {"date": "2025-06-12", "glucose": 9, "gpt": 87, "got": 60, "gotMito": 6, "alp": 222, "ggt": 331, "bilirubin": 7, "directBilirubin": 7.8, "totalProtein": 51, "albumin": 70, "albGlobRatio": 1.43, "bileAcid": 10.9, "urea": 7.3, "creatinine": 49, "uricAcid": 151, "sodium": 137, "potassium": 4, "chloride": 108, "co2": 35.9, "calcium": 0.95, "magnesium": 0.89, "cystatinC": 1.48, "lactate": 1, "ldh": 191, "ck": 52, "gsr": 73, "ckmb": 1.6, "myoglobin": 72.3, "troponin": 26.3, "amylase": 18, "aptt": 36.1, "pt": 14.4, "tt": 15.5, "fg": 4.6, "notes": "é–‹å§‹ä¸‹é™"},
            {"date": "2025-06-11", "glucose": 9.3, "gpt": 153, "got": 407, "gotMito": 167, "alp": 322, "ggt": 495, "bilirubin": 23, "directBilirubin": 13.1, "totalProtein": 50, "albumin": 97, "albGlobRatio": 1.08, "bileAcid": 12.7, "urea": 6.4, "creatinine": 61, "uricAcid": 175, "sodium": 132, "potassium": 4.1, "chloride": 104, "co2": 29.6, "calcium": 0.96, "lactate": 1.9, "ldh": 492, "ck": 71, "gsr": 67, "ckmb": 1.1, "myoglobin": 108.4, "troponin": 40.7, "aptt": 31, "pt": 13.4, "tt": 15.9, "fg": 3.9, "notes": "åš´é‡ç•°å¸¸æœŸ"},
            {"date": "2025-06-10", "glucose": 7.3, "gpt": 57, "got": 165, "alp": 271, "ggt": 374, "bilirubin": 11, "directBilirubin": 7, "totalProtein": 53, "albumin": 112, "albGlobRatio": 1.52, "bileAcid": 21.2, "urea": 6, "creatinine": 57, "uricAcid": 173, "sodium": 132, "potassium": 3.6, "chloride": 103, "co2": 27.8, "calcium": 0.97, "lactate": 1.7, "ldh": 350, "ck": 87, "gsr": 58, "ckmb": 1.6, "myoglobin": 119.5, "troponin": 21.8, "amylase": 38, "aptt": 31.7, "pt": 12.4, "tt": 16, "fg": 3.9, "notes": "è‚åŠŸèƒ½ç•°å¸¸"},
            {"date": "2025-06-02", "glucose": 7.4, "gpt": 12, "got": 17, "gotMito": 2, "alp": 50, "ggt": 18, "bilirubin": 17, "directBilirubin": 7.3, "totalProtein": 55, "albumin": 71, "albGlobRatio": 1.62, "bileAcid": 2.8, "urea": 3.2, "creatinine": 55, "uricAcid": 184, "sodium": 134, "potassium": 4, "chloride": 101, "co2": 36.4, "calcium": 1.26, "magnesium": 0.75, "cystatinC": 1.25, "lactate": 1.2, "ldh": 214, "ck": 42, "gsr": 63, "ckmb": 1.2, "myoglobin": 58, "troponin": 12.8, "il5": 4.9, "il17": 4.6, "il6": 344.9, "il8": 41.3, "il10": 7.44, "notes": ""},
            {"date": "2025-06-01", "glucose": 12.1, "gpt": 14, "got": 19, "gotMito": 1, "alp": 55, "ggt": 21, "bilirubin": 14, "directBilirubin": 8.5, "totalProtein": 51, "albumin": 75, "albGlobRatio": 1.22, "bileAcid": 1, "urea": 3.6, "creatinine": 49, "uricAcid": 203, "sodium": 129, "potassium": 4.3, "chloride": 100, "co2": 36, "calcium": 1.05, "lactate": 1.4, "ldh": 199, "ck": 37, "gsr": 62, "ckmb": 1.2, "myoglobin": 48, "troponin": 10.5, "aptt": 37, "pt": 14.3, "tt": 16.1, "fg": 5.2, "notes": "æŒçºŒæ”¹å–„"},
            {"date": "2025-05-30", "glucose": 8.6, "gpt": 24, "got": 25, "gotMito": 3, "alp": 52, "ggt": 26, "bilirubin": 23, "directBilirubin": 11.1, "totalProtein": 48, "albumin": 120, "albGlobRatio": 1.67, "bileAcid": 1.2, "urea": 7.1, "creatinine": 55, "uricAcid": 188, "sodium": 130, "potassium": 4, "chloride": 101, "co2": 35.3, "calcium": 1.06, "lactate": 0.9, "ldh": 198, "ck": 31, "gsr": 56, "ckmb": 1.1, "myoglobin": 45, "troponin": 12.5, "aptt": 37, "pt": 13.9, "tt": 16.3, "fg": 3.1, "notes": "é–‹å§‹å¥½è½‰"},
            {"date": "2025-05-28", "glucose": 9.9, "gpt": 39, "got": 44, "alp": 54, "ggt": 38, "bilirubin": 52, "directBilirubin": 15.9, "totalProtein": 51, "albumin": 172, "albGlobRatio": 1.83, "bileAcid": 1.9, "urea": 14.5, "creatinine": 63, "uricAcid": 230, "sodium": 134, "potassium": 4.7, "chloride": 102, "co2": 40.8, "calcium": 1.08, "lactate": 1.1, "ldh": 205, "ck": 92, "gsr": 61, "ckmb": 2, "myoglobin": 78, "troponin": 9.8, "aptt": 31.9, "pt": 13.6, "tt": 18.8, "fg": 1.4, "notes": ""},
            {"date": "2025-05-27", "glucose": 13.4, "gpt": 35, "got": 45, "gotMito": 10, "alp": 49, "ggt": 35, "bilirubin": 48, "directBilirubin": 14.7, "totalProtein": 54, "albumin": 168, "albGlobRatio": 1.84, "bileAcid": 1.9, "urea": 13.7, "creatinine": 62, "uricAcid": 214, "sodium": 142, "potassium": 4.5, "chloride": 105, "co2": 41.9, "calcium": 1.1, "lactate": 1.3, "ldh": 222, "ck": 39, "gsr": 59, "ckmb": 1.4, "myoglobin": 91.9, "troponin": 23.1, "aptt": 30.5, "pt": 14.3, "tt": 20.2, "fg": 1.6, "notes": "è‚åŠŸèƒ½ç•°å¸¸"},
            {"date": "2025-05-26", "glucose": 14.6, "gpt": 24, "got": 40, "gotMito": 12, "alp": 54, "ggt": 33, "bilirubin": 68, "directBilirubin": 18.3, "totalProtein": 55, "albumin": 143, "albGlobRatio": 1.75, "bileAcid": 4.1, "urea": 13.5, "creatinine": 57, "uricAcid": 219, "sodium": 146, "potassium": 4.9, "chloride": 109, "co2": 46, "calcium": 1.09, "magnesium": 1.02, "cystatinC": 1.59, "lactate": 1.5, "ldh": 237, "ck": 12, "gsr": 52, "ckmb": 0.7, "myoglobin": 36, "troponin": 17.2, "aptt": 31.3, "pt": 14.7, "tt": 20.5, "fg": 1.9, "notes": "å¤šé …æŒ‡æ¨™ç•°å¸¸"},
            {"date": "2025-05-25", "glucose": 13.6, "gpt": 12, "got": 21, "gotMito": 4, "alp": 65, "ggt": 24, "bilirubin": 47, "directBilirubin": 10.6, "totalProtein": 58, "albumin": 128, "albGlobRatio": 2.05, "bileAcid": 1, "urea": 11.9, "creatinine": 56, "uricAcid": 206, "sodium": 147, "potassium": 3.1, "chloride": 116, "co2": 46.8, "calcium": 1, "lactate": 1.7, "ldh": 258, "ck": 10, "gsr": 46, "ckmb": 0.7, "myoglobin": 29.1, "troponin": 30.5, "aptt": 32.9, "pt": 15.1, "tt": 21, "fg": 2.2, "notes": "è†½ç´…ç´ å‡é«˜"},
            {"date": "2025-05-24", "glucose": 11.7, "gpt": 7, "got": 16, "alp": 70, "ggt": 19, "bilirubin": 45, "directBilirubin": 5.8, "totalProtein": 57, "albumin": 102, "albGlobRatio": 1.85, "bileAcid": 1, "urea": 15.2, "creatinine": 67, "uricAcid": 308, "sodium": 145, "potassium": 4.2, "chloride": 107, "co2": 46.2, "lactate": 1.6, "ldh": 216, "ck": 13, "gsr": 43, "ckmb": 1.1, "myoglobin": 36.9, "troponin": 56.2, "aptt": 29.4, "pt": 15.4, "tt": 20.2, "fg": 2.8, "notes": ""},
            {"date": "2025-05-23", "glucose": 15.3, "gpt": 9, "got": 14, "gotMito": 3, "alp": 87, "ggt": 19, "bilirubin": 42, "directBilirubin": 7.6, "totalProtein": 57, "albumin": 86, "albGlobRatio": 1.71, "bileAcid": 1.2, "urea": 18.4, "creatinine": 86, "uricAcid": 512, "sodium": 147, "potassium": 4.2, "chloride": 106, "co2": 45.1, "lactate": 1.4, "ldh": 199, "ck": 19, "gsr": 39, "ckmb": 3.6, "myoglobin": 59.1, "troponin": 63.6, "notes": "è¡€ç³–éé«˜"},
            {"date": "2025-05-19", "glucose": 2.2, "gpt": 18, "got": 30, "gotMito": 3, "alp": 166, "ggt": 36, "directBilirubin": 7.8, "totalProtein": 49, "albGlobRatio": 0.96, "urea": 18.1, "creatinine": 154, "uricAcid": 532, "sodium": 136, "potassium": 3.16, "chloride": 102, "gsr": 44, "ckmb": 4, "myoglobin": 87.9, "troponin": 93.5, "amylase": 4, "aptt": 37, "pt": 15.1, "tt": 16.4, "fg": 7.8, "notes": "è¡€ç³–åä½"},
            {"date": "2025-05-18", "glucose": 5.7, "gpt": 29, "got": 43, "gotMito": 6, "alp": 252, "ggt": 56, "directBilirubin": 16, "totalProtein": 57, "albGlobRatio": 1.19, "urea": 12.8, "creatinine": 166, "uricAcid": 417, "sodium": 131, "potassium": 3.51, "chloride": 98, "ldh": 271, "ck": 54, "gsr": 55, "ckmb": 2.4, "myoglobin": 122.6, "troponin": 24.8, "amylase": 12, "aptt": 33.2, "pt": 14.2, "tt": 17.1, "fg": 6.9, "notes": "åˆå§‹å…¨é¢æª¢é©—"}
        ];
        
        // æª¢æŸ¥æ˜¯å¦å·²æœ‰æ•¸æ“šï¼Œå¼·åˆ¶ä½¿ç”¨å®Œæ•´çš„é è£æ•¸æ“š
        let healthRecords = preloadedHealthRecords.slice(); // ç›´æ¥ä½¿ç”¨é è£æ•¸æ“š
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
        localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
        
        // ç•¶å‰åœ–è¡¨å¯¦ä¾‹
        let currentChart = null;
        
        // è¨­ç½®ä»Šå¤©çš„æ—¥æœŸ
        document.getElementById('testDate').value = new Date().toISOString().split('T')[0];
        
        // æ¨™ç±¤é åˆ‡æ›
        function showTab(tabName) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤é å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„activeé¡
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤é 
            document.getElementById(tabName).classList.add('active');
            
            // çµ¦å°æ‡‰æ¨™ç±¤æ·»åŠ activeé¡
            event.target.classList.add('active');
            
            // æ ¹æ“šæ¨™ç±¤é é¡å‹åŸ·è¡Œç›¸æ‡‰çš„åˆå§‹åŒ–
            if (tabName === 'records') {
                displayRecords();
            } else if (tabName === 'charts') {
                initializeChart();
                updateChart();
                updateDataStats();
            } else if (tabName === 'summary') {
                updateHealthSummary();
            }
        }
        
        // ä¿å­˜è¨˜éŒ„
        function saveRecord() {
            const date = document.getElementById('testDate').value;
            if (!date) {
                alert('è«‹å…ˆé¸æ“‡æª¢æŸ¥æ—¥æœŸï¼');
                return;
            }
            
            const record = {
                date: date,
                notes: document.getElementById('notes').value || ''
            };
            
            // ç²å–æ‰€æœ‰æª¢é©—é …ç›®çš„å€¼
            let hasData = false;
            Object.keys(testConfigs).forEach(key => {
                const element = document.getElementById(key);
                if (element && element.value !== '') {
                    record[key] = parseFloat(element.value);
                    hasData = true;
                }
            });
            
            if (!hasData) {
                alert('è«‹è‡³å°‘è¼¸å…¥ä¸€é …æª¢é©—æ•¸æ“šï¼');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦æœ‰é‡è¤‡æ—¥æœŸçš„è¨˜éŒ„
            const existingIndex = healthRecords.findIndex(r => r.date === date);
            if (existingIndex >= 0) {
                if (confirm('é€™å€‹æ—¥æœŸå·²ç¶“æœ‰è¨˜éŒ„äº†ï¼Œè¦è¦†è“‹å—ï¼Ÿ')) {
                    healthRecords[existingIndex] = record;
                } else {
                    return;
                }
            } else {
                healthRecords.push(record);
            }
            
            // æŒ‰æ—¥æœŸæ’åº
            healthRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // ä¿å­˜åˆ°æœ¬åœ°
            localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
            
            // é¡¯ç¤ºæˆåŠŸæ¶ˆæ¯
            const successMsg = document.getElementById('successMessage');
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
            
            // æ¸…ç©ºè¡¨å–®ï¼ˆé™¤äº†æ—¥æœŸï¼‰
            clearCurrentForm(false);
            
            // æ›´æ–°æ—¥æœŸåˆ°æ˜å¤©
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('testDate').value = tomorrow.toISOString().split('T')[0];
        }
        
        // æ¸…ç©ºç•¶å‰è¡¨å–®
        function clearCurrentForm(clearDate = true) {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºç•¶å‰è¼¸å…¥çš„å…§å®¹å—ï¼Ÿ')) {
                Object.keys(testConfigs).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = '';
                    }
                });
                document.getElementById('notes').value = '';
                if (clearDate) {
                    document.getElementById('testDate').value = new Date().toISOString().split('T')[0];
                }
            }
        }
        
        // åŠ è¼‰æœ€æ–°æ•¸æ“šæ¨¡æ¿
        function loadLatestData() {
            if (confirm('ç¢ºå®šè¦åŠ è¼‰æœ€æ–°æª¢é©—æ•¸æ“šæ¨¡æ¿å—ï¼Ÿé€™æœƒè¦†è“‹ç•¶å‰è¼¸å…¥çš„å…§å®¹ã€‚')) {
                if (healthRecords.length > 0) {
                    const latestRecord = healthRecords[0];
                    
                    Object.keys(testConfigs).forEach(key => {
                        const element = document.getElementById(key);
                        if (element && latestRecord[key] !== undefined && latestRecord[key] !== null) {
                            element.value = latestRecord[key];
                        }
                    });
                    
                    document.getElementById('notes').value = 'åŸºæ–¼æœ€æ–°æª¢é©—æ•¸æ“š';
                    alert('å·²åŠ è¼‰æœ€æ–°æª¢é©—æ•¸æ“šä½œç‚ºæ¨¡æ¿ï¼');
                } else {
                    alert('æš«ç„¡æ­·å²æ•¸æ“šï¼Œå°‡åŠ è¼‰ç¤ºä¾‹æ•¸æ“š...');
                    loadSampleData();
                }
            }
        }
        
        // åŠ è¼‰ç¤ºä¾‹æ•¸æ“šåˆ°è¡¨å–®
        function loadSampleData() {
            const sampleData = preloadedHealthRecords[0]; // ä½¿ç”¨ç¬¬ä¸€æ¢é è£æ•¸æ“š
            
            Object.keys(sampleData).forEach(key => {
                if (key !== 'date' && key !== 'notes') {
                    const element = document.getElementById(key);
                    if (element && sampleData[key] !== null && sampleData[key] !== undefined) {
                        element.value = sampleData[key];
                    }
                }
            });
            
            document.getElementById('notes').value = 'ç¤ºä¾‹æª¢é©—æ•¸æ“š';
        }
        
        // åˆå§‹åŒ–åœ–è¡¨
        function initializeChart() {
            // åˆå§‹åŒ–åœ–è¡¨é¸æ“‡å™¨
            const chartTypeSelect = document.getElementById('chartType');
            chartTypeSelect.innerHTML = '';
            
            // æ·»åŠ æ‰€æœ‰æª¢é©—é …ç›®åˆ°ä¸‹æ‹‰é¸å–®
            Object.keys(testConfigs).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = testConfigs[key].name;
                chartTypeSelect.appendChild(option);
            });
            
            // åˆå§‹åŒ–æ¸¬è©¦æŒ‰éˆ•
            const buttonsContainer = document.getElementById('testButtons');
            buttonsContainer.innerHTML = '';
            
            // æª¢æŸ¥å“ªäº›æª¢é©—é …ç›®æœ‰æ•¸æ“š
            const dataStats = {};
            healthRecords.forEach(record => {
                Object.keys(record).forEach(key => {
                    if (key !== 'date' && key !== 'notes' && testConfigs[key] && record[key] !== null && record[key] !== undefined) {
                        dataStats[key] = (dataStats[key] || 0) + 1;
                    }
                });
            });
            
            // åªé¡¯ç¤ºæœ‰æ•¸æ“šçš„æª¢é©—é …ç›®
            const validDataKeys = Object.keys(dataStats).filter(key => dataStats[key] >= 1);
            
            // æŒ‰åˆ†é¡çµ„ç¹”æŒ‰éˆ•
            const categories = {
                'åŸºç¤ä»£è¬': ['glucose', 'lactate'],
                'è‚åŠŸèƒ½': ['gpt', 'got', 'gotMito', 'alp', 'ggt', 'ldh', 'gsr'],
                'è†½ç´…ç´ ': ['bilirubin', 'directBilirubin', 'bileAcid'],
                'è›‹ç™½è³ª': ['totalProtein', 'albumin', 'albGlobRatio'],
                'è…åŠŸèƒ½': ['urea', 'creatinine', 'uricAcid', 'cystatinC'],
                'é›»è§£è³ª': ['sodium', 'potassium', 'chloride', 'co2', 'calcium', 'phosphorus', 'magnesium'],
                'å¿ƒè‚Œæ¨™èªŒç‰©': ['ck', 'hfabp', 'ckmb', 'myoglobin', 'troponin'],
                'å…¶ä»–': ['amylase'],
                'ç‚ç—‡æ¨™èªŒç‰©': ['il2', 'il4', 'il5', 'il6', 'il8', 'il10', 'il1b', 'il12', 'il17', 'tnfa'],
                'å‡è¡€åŠŸèƒ½': ['aptt', 'pt', 'tt', 'fg']
            };
            
            // ç‚ºæ¯å€‹åˆ†é¡å‰µå»ºæŒ‰éˆ•çµ„
            Object.keys(categories).forEach(categoryName => {
                const categoryValidItems = categories[categoryName].filter(key => validDataKeys.includes(key));
                if (categoryValidItems.length === 0) return;
                
                // å‰µå»ºåˆ†é¡æ¨™é¡Œ
                const categoryLabel = document.createElement('div');
                categoryLabel.style.cssText = 'width: 100%; font-weight: bold; color: #6c5ce7; margin: 10px 5px 5px 5px; font-size: 0.9em; border-bottom: 1px solid #e9ecef; padding-bottom: 3px;';
                categoryLabel.textContent = `${categoryName} (${categoryValidItems.length}é …)`;
                buttonsContainer.appendChild(categoryLabel);
                
                // ç‚ºè©²åˆ†é¡å‰µå»ºæŒ‰éˆ•
                categoryValidItems.forEach(testKey => {
                    const btn = document.createElement('button');
                    btn.className = 'test-btn';
                    if (testKey === 'glucose') btn.classList.add('active');
                    
                    btn.onclick = function() { 
                        quickSelectChart(this, testKey); 
                    };
                    
                    btn.textContent = `${testConfigs[testKey].name} (${dataStats[testKey]})`;
                    btn.dataset.test = testKey;
                    btn.title = `${testConfigs[testKey].name} (${testConfigs[testKey].unit}) - ${dataStats[testKey]}å€‹æ•¸æ“šé»`;
                    buttonsContainer.appendChild(btn);
                });
            });
            
            updateDataStats();
        }
        
        // æ›´æ–°æ•¸æ“šçµ±è¨ˆä¿¡æ¯
        function updateDataStats() {
            const statsElement = document.getElementById('dataStatsInfo');
            if (!statsElement) return;
            
            const dataStats = {};
            Object.keys(testConfigs).forEach(key => {
                const count = healthRecords.filter(record => 
                    record[key] !== undefined && record[key] !== null
                ).length;
                if (count > 0) {
                    dataStats[key] = count;
                }
            });
            
            const totalItems = Object.keys(dataStats).length;
            const totalRecords = healthRecords.length;
            const avgDataPerRecord = totalRecords > 0 ? 
                Object.values(dataStats).reduce((sum, count) => sum + count, 0) / totalRecords : 0;
            
            statsElement.innerHTML = `
                å…± ${totalRecords} æ¢è¨˜éŒ„ï¼ŒåŒ…å« ${totalItems} é …æª¢é©—æŒ‡æ¨™ï¼Œ
                å¹³å‡æ¯æ¬¡æª¢æŸ¥ ${avgDataPerRecord.toFixed(1)} é …æŒ‡æ¨™
            `;
        }
        
        // å¿«é€Ÿé¸æ“‡åœ–è¡¨
        function quickSelectChart(button, testType) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.test-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // æ›´æ–°ä¸‹æ‹‰é¸æ“‡
            document.getElementById('chartType').value = testType;
            
            // æ›´æ–°åœ–è¡¨
            updateChart();
        }
        
        // æ›´æ–°åœ–è¡¨
        function updateChart() {
            try {
                const testType = document.getElementById('chartType').value;
                const dataRange = document.getElementById('dataRange').value;
                const chartStyle = document.getElementById('chartStyle').value;
                const config = testConfigs[testType];
                
                if (!config) return;
                
                // ç²å–è©²æª¢é©—é …ç›®çš„æ‰€æœ‰æ•¸æ“š
                let allData = healthRecords
                    .filter(record => record[testType] !== undefined && record[testType] !== null)
                    .map(record => ({
                        date: record.date,
                        value: record[testType],
                        notes: record.notes || ''
                    }))
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // æ ¹æ“šé¸æ“‡çš„ç¯„åœéæ¿¾æ•¸æ“š
                let chartData;
                if (dataRange === 'all') {
                    chartData = allData;
                } else {
                    const rangeNum = parseInt(dataRange);
                    chartData = allData.slice(-rangeNum);
                }
                
                if (chartData.length === 0) {
                    updateStats(testType, []);
                    if (currentChart) {
                        currentChart.destroy();
                        currentChart = null;
                    }
                    return;
                }
                
                // æº–å‚™åœ–è¡¨æ•¸æ“š
                const chartConfigData = {
                    labels: chartData.map(record => {
                        const date = new Date(record.date);
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    }),
                    datasets: [{
                        label: config.name + ' (' + config.unit + ')',
                        data: chartData.map(record => record.value),
                        borderColor: '#6c5ce7',
                        backgroundColor: chartData.map(record => {
                            const value = record.value;
                            if (config.min !== undefined && value < config.min) return 'rgba(253, 203, 110, 0.7)';
                            if (config.max !== undefined && value > config.max) return 'rgba(225, 112, 85, 0.7)';
                            return 'rgba(0, 184, 148, 0.7)';
                        }),
                        tension: 0.3,
                        fill: chartStyle === 'line',
                        pointRadius: chartStyle === 'line' ? 4 : 0,
                        pointHoverRadius: chartStyle === 'line' ? 6 : 0,
                        borderWidth: chartStyle === 'line' ? 2 : 0
                    }]
                };
                
                // éŠ·æ¯€èˆŠåœ–è¡¨
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                }
                
                // å‰µå»ºæ–°åœ–è¡¨
                const ctx = document.getElementById('trendChart').getContext('2d');
                
                const values = chartData.map(r => r.value);
                const minValue = Math.min(...values);
                const maxValue = Math.max(...values);
                const range = maxValue - minValue;
                const padding = range * 0.1 || 1;
                
                currentChart = new Chart(ctx, {
                    type: chartStyle === 'line' ? 'line' : 'bar',
                    data: chartConfigData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `${config.name} ${chartStyle === 'line' ? 'è¶¨å‹¢åœ–' : 'æ•¸å€¼åœ–'} (æ­£å¸¸ç¯„åœ: ${config.min}-${config.max} ${config.unit})`,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                display: true
                            },
                            tooltip: {
                                callbacks: {
                                    afterLabel: function(context) {
                                        const index = context.dataIndex;
                                        const record = chartData[index];
                                        return record.notes ? `å‚™è¨»: ${record.notes}` : '';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: Math.max(0, minValue - padding),
                                max: maxValue + padding,
                                title: {
                                    display: true,
                                    text: `${config.name} (${config.unit})`
                                },
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'æª¢æŸ¥æ—¥æœŸ'
                                },
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            }
                        }
                    }
                });
                
                updateStats(testType, values);
                
            } catch (error) {
                console.error('æ›´æ–°åœ–è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
        }
        
        // æ›´æ–°çµ±è¨ˆä¿¡æ¯
        function updateStats(testType, values) {
            const config = testConfigs[testType];
            
            if (values.length === 0) {
                document.getElementById('latestValue').textContent = '-';
                document.getElementById('averageValue').textContent = '-';
                document.getElementById('maxValue').textContent = '-';
                document.getElementById('minValue').textContent = '-';
                document.getElementById('recordCount').textContent = '0';
                document.getElementById('trendAnalysis').textContent = '-';
                return;
            }
            
            const latest = values[values.length - 1];
            const average = values.reduce((a, b) => a + b, 0) / values.length;
            const max = Math.max(...values);
            const min = Math.min(...values);
            const trend = values.length > 1 ? values[values.length - 1] - values[0] : 0;
            
            document.getElementById('latestValue').textContent = `${latest} ${config.unit}`;
            document.getElementById('averageValue').textContent = `${average.toFixed(1)} ${config.unit}`;
            document.getElementById('maxValue').textContent = `${max} ${config.unit}`;
            document.getElementById('minValue').textContent = `${min} ${config.unit}`;
            document.getElementById('recordCount').textContent = values.length;
            
            let trendText = 'â†’ ç©©å®š';
            const trendPercent = Math.abs(trend / values[0]) * 100;
            if (trendPercent > 5) {
                trendText = trend > 0 ? 'â†‘ ä¸Šå‡' : 'â†“ ä¸‹é™';
            }
            document.getElementById('trendAnalysis').textContent = trendText;
        }
        
        // æœç´¢åŠŸèƒ½
        function filterChartButtons() {
            const searchTerm = document.getElementById('chartSearch').value.toLowerCase();
            const buttons = document.querySelectorAll('.test-btn');
            
            buttons.forEach(button => {
                const text = button.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    button.style.display = 'inline-block';
                } else {
                    button.style.display = 'none';
                }
            });
        }
        
        // å¤šé …å°æ¯”åœ–è¡¨
        function showMultiChart() {
            const selectedTests = ['glucose', 'gpt', 'got', 'bilirubin'];
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            const datasets = selectedTests.map((testType, index) => {
                const config = testConfigs[testType];
                const data = healthRecords
                    .filter(record => record[testType] !== undefined && record[testType] !== null)
                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                    .slice(-15);
                
                const colors = ['#6c5ce7', '#00b894', '#fd79a8', '#fdcb6e'];
                
                return {
                    label: config.name,
                    data: data.map(record => ({
                        x: record.date,
                        y: record[testType]
                    })),
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    tension: 0.3,
                    pointRadius: 3,
                    pointHoverRadius: 5
                };
            });
            
            const ctx = document.getElementById('trendChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'å¤šé …æŒ‡æ¨™å°æ¯”åœ– (æœ€è¿‘15æ¬¡è¨˜éŒ„)',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MM/DD'
                                }
                            },
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'æ•¸å€¼'
                            }
                        }
                    }
                }
            });
        }
        
        // å°å‡ºåœ–è¡¨
        function exportChart() {
            if (!currentChart) {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹æª¢é©—é …ç›®ç”Ÿæˆåœ–è¡¨ï¼');
                return;
            }
            
            const url = currentChart.toBase64Image();
            const link = document.createElement('a');
            link.download = `å¥åº·è¶¨å‹¢åœ–_${new Date().toISOString().split('T')[0]}.png`;
            link.href = url;
            link.click();
            
            alert('åœ–è¡¨å·²å°å‡ºç‚ºPNGåœ–ç‰‡ï¼');
        }
        
        // é¡¯ç¤ºè¨˜éŒ„
        function displayRecords() {
            const recordsList = document.getElementById('recordsList');
            recordsList.innerHTML = '';
            
            document.getElementById('totalRecords').textContent = healthRecords.length;
            if (healthRecords.length > 0) {
                const dates = healthRecords.map(r => r.date).sort();
                document.getElementById('dateRange').textContent = `${dates[0]} è‡³ ${dates[dates.length - 1]}`;
            }
            
            if (healthRecords.length === 0) {
                recordsList.innerHTML = '<div class="alert alert-info"><h3>é‚„æ²’æœ‰è¨˜éŒ„</h3><p>è«‹å…ˆæ·»åŠ æª¢é©—è¨˜éŒ„ï¼</p></div>';
                return;
            }
            
            healthRecords.forEach((record, index) => {
                const card = document.createElement('div');
                card.className = 'record-card';
                
                const formattedDate = new Date(record.date).toLocaleDateString('zh-TW', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
                
                let valuesHtml = '';
                let dataCount = 0;
                Object.keys(testConfigs).forEach(key => {
                    if (record[key] !== undefined && record[key] !== null) {
                        const config = testConfigs[key];
                        const status = getValueStatus(record[key], config.min, config.max);
                        valuesHtml += `
                            <div class="record-item">
                                <div class="record-item-name">${config.name}</div>
                                <div class="record-item-value ${status}">${record[key]} ${config.unit}</div>
                            </div>
                        `;
                        dataCount++;
                    }
                });
                
                card.innerHTML = `
                    <div class="record-date">${formattedDate} <span style="font-size: 0.8em; color: #666;">(${dataCount}é …æ•¸æ“š)</span></div>
                    <div class="record-values">${valuesHtml}</div>
                    ${record.notes ? `<div style="margin-top: 15px; padding: 10px; background: white; border-radius: 8px; border-left: 4px solid #6c5ce7;"><strong>ğŸ“ å‚™è¨»ï¼š</strong>${record.notes}</div>` : ''}
                    <button onclick="deleteRecord(${index})" style="margin-top: 15px; padding: 8px 16px; background: #fd79a8; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ—‘ï¸ åˆªé™¤é€™æ¢è¨˜éŒ„</button>
                `;
                
                recordsList.appendChild(card);
            });
        }
        
        function getValueStatus(value, min, max) {
            if (min !== undefined && value < min) return 'value-low';
            if (max !== undefined && value > max) return 'value-high';
            return 'value-normal';
        }
        
        function deleteRecord(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™æ¢è¨˜éŒ„å—ï¼Ÿåˆªé™¤å¾Œç„¡æ³•æ¢å¾©ï¼')) {
                healthRecords.splice(index, 1);
                localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
                displayRecords();
            }
        }
        
        function filterRecords() {
            const searchTerm = document.getElementById('recordSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.record-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // æ›´æ–°å¥åº·ç¸½è¦½
        function updateHealthSummary() {
            if (healthRecords.length === 0) {
                document.getElementById('summaryTotalRecords').textContent = '0';
                document.getElementById('summaryDays').textContent = '0';
                document.getElementById('summaryAbnormal').textContent = '0';
                document.getElementById('summaryNormal').textContent = '0';
                document.getElementById('latestAnalysis').innerHTML = '<p style="color: #666;">æš«ç„¡æª¢é©—è¨˜éŒ„</p>';
                document.getElementById('trendSummary').innerHTML = '<p style="color: #666;">æš«ç„¡è¶¨å‹¢æ•¸æ“š</p>';
                document.getElementById('alertItems').innerHTML = '<p style="color: #666;">æš«ç„¡ç•°å¸¸é …ç›®</p>';
                return;
            }
            
            // åŸºæœ¬çµ±è¨ˆ
            const dates = healthRecords.map(r => r.date).sort();
            const daysDiff = Math.ceil((new Date(dates[dates.length - 1]) - new Date(dates[0])) / (1000 * 60 * 60 * 24)) + 1;
            
            document.getElementById('summaryTotalRecords').textContent = healthRecords.length;
            document.getElementById('summaryDays').textContent = daysDiff;
            
            // åˆ†ææœ€æ–°è¨˜éŒ„
            const latestRecord = healthRecords[0];
            let normalCount = 0;
            let abnormalCount = 0;
            let analysisHtml = `<h4>ğŸ“… ${latestRecord.date} æª¢é©—çµæœåˆ†æ</h4><div style="margin-top: 10px;">`;
            
            Object.keys(testConfigs).forEach(key => {
                if (latestRecord[key] !== undefined && latestRecord[key] !== null) {
                    const config = testConfigs[key];
                    const value = latestRecord[key];
                    const status = getValueStatus(value, config.min, config.max);
                    
                    if (status === 'value-normal') {
                        normalCount++;
                    } else {
                        abnormalCount++;
                        const statusText = status === 'value-high' ? 'åé«˜' : 'åä½';
                        analysisHtml += `<div style="color: ${status === 'value-high' ? '#e17055' : '#fdcb6e'}; margin: 5px 0;">âš ï¸ ${config.name}: ${value} ${config.unit} (${statusText})</div>`;
                    }
                }
            });
            
            if (abnormalCount === 0) {
                analysisHtml += '<div style="color: #00b894;">âœ… æ‰€æœ‰æª¢é©—æŒ‡æ¨™å‡åœ¨æ­£å¸¸ç¯„åœå…§</div>';
            }
            
            analysisHtml += '</div>';
            
            document.getElementById('summaryNormal').textContent = normalCount;
            document.getElementById('summaryAbnormal').textContent = abnormalCount;
            document.getElementById('latestAnalysis').innerHTML = analysisHtml;
            
            // è¶¨å‹¢åˆ†æ
            let trendHtml = '<h4>ğŸ“ˆ ä¸»è¦æŒ‡æ¨™è¶¨å‹¢åˆ†æ</h4><div style="margin-top: 10px;">';
            const keyIndicators = ['glucose', 'gpt', 'got', 'bilirubin', 'creatinine'];
            
            keyIndicators.forEach(key => {
                const values = healthRecords
                    .filter(r => r[key] !== undefined && r[key] !== null)
                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                    .map(r => r[key]);
                
                if (values.length >= 3) {
                    const config = testConfigs[key];
                    const latest = values[values.length - 1];
                    const previous = values[values.length - 2];
                    const trend = latest - previous;
                    const trendPercent = Math.abs(trend / previous) * 100;
                    
                    let trendIcon = 'â†’';
                    let trendColor = '#666';
                    let trendText = 'ç©©å®š';
                    
                    if (trendPercent > 5) {
                        if (trend > 0) {
                            trendIcon = 'â†‘';
                            trendColor = '#e17055';
                            trendText = 'ä¸Šå‡';
                        } else {
                            trendIcon = 'â†“';
                            trendColor = '#00b894';
                            trendText = 'ä¸‹é™';
                        }
                    }
                    
                    trendHtml += `<div style="margin: 5px 0;"><span style="color: ${trendColor};">${trendIcon} ${config.name}: ${trendText} (${latest} ${config.unit})</span></div>`;
                }
            });
            
            trendHtml += '</div>';
            document.getElementById('trendSummary').innerHTML = trendHtml;
            
            // é‡é»é—œæ³¨é …ç›®
            let alertHtml = '<h4>âš ï¸ éœ€è¦é‡é»é—œæ³¨çš„é …ç›®</h4><div style="margin-top: 10px;">';
            let hasAlerts = false;
            
            // æª¢æŸ¥æŒçºŒç•°å¸¸çš„é …ç›®
            Object.keys(testConfigs).forEach(key => {
                const recentValues = healthRecords
                    .filter(r => r[key] !== undefined && r[key] !== null)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 3)
                    .map(r => ({ value: r[key], date: r.date }));
                
                if (recentValues.length >= 2) {
                    const config = testConfigs[key];
                    const consecutiveAbnormal = recentValues.every(item => {
                        const status = getValueStatus(item.value, config.min, config.max);
                        return status !== 'value-normal';
                    });
                    
                    if (consecutiveAbnormal) {
                        hasAlerts = true;
                        const latest = recentValues[0];
                        const status = getValueStatus(latest.value, config.min, config.max);
                        const statusText = status === 'value-high' ? 'æŒçºŒåé«˜' : 'æŒçºŒåä½';
                        alertHtml += `<div style="color: #e17055; margin: 5px 0;">ğŸ”´ ${config.name}: ${statusText} (æœ€æ–°å€¼: ${latest.value} ${config.unit})</div>`;
                    }
                }
            });
            
            if (!hasAlerts) {
                alertHtml += '<div style="color: #00b894;">âœ… ç›®å‰æ²’æœ‰éœ€è¦ç‰¹åˆ¥é—œæ³¨çš„ç•°å¸¸é …ç›®</div>';
            }
            
            alertHtml += '</div>';
            document.getElementById('alertItems').innerHTML = alertHtml;
        }
        
        // æ•¸æ“šå°å‡ºåŠŸèƒ½
        function exportToExcel() {
            const ws_data = [];
            
            // å‰µå»ºè¡¨é ­
            const headers = ['æ—¥æœŸ'];
            Object.keys(testConfigs).forEach(key => {
                headers.push(`${testConfigs[key].name}(${testConfigs[key].unit})`);
            });
            headers.push('å‚™è¨»');
            ws_data.push(headers);
            
            // æ·»åŠ æ•¸æ“šè¡Œ
            healthRecords.forEach(record => {
                const row = [record.date];
                Object.keys(testConfigs).forEach(key => {
                    row.push(record[key] || '');
                });
                row.push(record.notes || '');
                ws_data.push(row);
            });
            
            // å‰µå»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            
            // è¨­ç½®åˆ—å¯¬
            const colWidths = headers.map(() => ({ wch: 15 }));
            ws['!cols'] = colWidths;
            
            XLSX.utils.book_append_sheet(wb, ws, "å¥åº·è¨˜éŒ„");
            
            // å°å‡ºæ–‡ä»¶
            const fileName = `å¥¶å¥¶å¥åº·è¨˜éŒ„_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert(`Excelæ–‡ä»¶å·²å°å‡ºï¼š${fileName}`);
        }
        
        function exportToCSV() {
            let csvContent = '\ufeff'; // BOM for UTF-8
            
            // è¡¨é ­
            const headers = ['æ—¥æœŸ'];
            Object.keys(testConfigs).forEach(key => {
                headers.push(`${testConfigs[key].name}(${testConfigs[key].unit})`);
            });
            headers.push('å‚™è¨»');
            csvContent += headers.join(',') + '\n';
            
            // æ•¸æ“šè¡Œ
            healthRecords.forEach(record => {
                const row = [record.date];
                Object.keys(testConfigs).forEach(key => {
                    row.push(record[key] || '');
                });
                row.push(`"${record.notes || ''}"`);
                csvContent += row.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `å¥¶å¥¶å¥åº·è¨˜éŒ„_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('CSVæ–‡ä»¶å·²å°å‡ºï¼');
        }
        
        function exportToJSON() {
            const dataStr = JSON.stringify(healthRecords, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `å¥¶å¥¶å¥åº·è¨˜éŒ„_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('JSONæ–‡ä»¶å·²å°å‡ºï¼');
        }
        
        function copyToClipboard() {
            const dataStr = JSON.stringify(healthRecords, null, 2);
            navigator.clipboard.writeText(dataStr).then(() => {
                alert('æ•¸æ“šå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            }).catch(() => {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½æ•¸æ“šã€‚');
            });
        }
        
        // æ•¸æ“šå°å…¥åŠŸèƒ½
        function importData() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è«‹é¸æ“‡è¦å°å…¥çš„æ–‡ä»¶ï¼');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let importedData = [];
                    
                    if (file.name.endsWith('.json')) {
                        const jsonData = JSON.parse(e.target.result);
                        importedData = Array.isArray(jsonData) ? jsonData : jsonData.records || [];
                    } else {
                        alert('ç›®å‰åªæ”¯æŒJSONæ ¼å¼å°å…¥ï¼Œè«‹ä½¿ç”¨å°å‡ºçš„JSONæ–‡ä»¶ã€‚');
                        return;
                    }
                    
                    if (importedData.length === 0) {
                        alert('æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ•¸æ“šè¨˜éŒ„ï¼');
                        return;
                    }
                    
                    const action = confirm('é¸æ“‡å°å…¥æ–¹å¼ï¼š\nç¢ºå®š = åˆä½µæ•¸æ“šï¼ˆä¿ç•™ç¾æœ‰è¨˜éŒ„ï¼‰\nå–æ¶ˆ = æ›¿æ›æ•¸æ“šï¼ˆæ¸…ç©ºç¾æœ‰è¨˜éŒ„ï¼‰');
                    
                    if (action) {
                        // åˆä½µæ•¸æ“š
                        let newRecords = 0;
                        let updatedRecords = 0;
                        
                        importedData.forEach(record => {
                            const existingIndex = healthRecords.findIndex(r => r.date === record.date);
                            if (existingIndex >= 0) {
                                healthRecords[existingIndex] = record;
                                updatedRecords++;
                            } else {
                                healthRecords.push(record);
                                newRecords++;
                            }
                        });
                        
                        alert(`æ•¸æ“šå°å…¥æˆåŠŸï¼æ–°å¢ ${newRecords} æ¢è¨˜éŒ„ï¼Œæ›´æ–° ${updatedRecords} æ¢è¨˜éŒ„ã€‚`);
                    } else {
                        // æ›¿æ›æ•¸æ“š
                        healthRecords = importedData;
                        alert(`æ•¸æ“šå°å…¥æˆåŠŸï¼å…±å°å…¥ ${importedData.length} æ¢è¨˜éŒ„ï¼Œå·²æ›¿æ›æ‰€æœ‰ç¾æœ‰æ•¸æ“šã€‚`);
                    }
                    
                    // æ’åºä¸¦ä¿å­˜
                    healthRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
                    localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
                    
                    // åˆ·æ–°é¡¯ç¤º
                    displayRecords();
                    
                } catch (error) {
                    console.error('Import error:', error);
                    alert(`å°å…¥å¤±æ•—ï¼š${error.message}`);
                }
            };
            
            reader.readAsText(file, 'UTF-8');
        }
        
        function loadPreloadedData() {
            // å¼·åˆ¶æ¢å¾©å®Œæ•´çš„é è¨­æ•¸æ“š
            healthRecords = preloadedHealthRecords.slice();
            localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
            
            // é‡æ–°åˆå§‹åŒ–åœ–è¡¨
            initializeChart();
            updateChart();
            updateDataStats();
            displayRecords();
            
            // è¨ˆç®—å¯¦éš›åŒ…å«çš„æª¢é©—é …ç›®æ•¸é‡
            const dataKeys = new Set();
            healthRecords.forEach(record => {
                Object.keys(record).forEach(key => {
                    if (key !== 'date' && key !== 'notes' && testConfigs[key]) {
                        dataKeys.add(key);
                    }
                });
            });
            
            alert(`å·²å¼·åˆ¶æ¢å¾©çœŸå¯¦æ•¸æ“šï¼\n\nâœ… å…± ${healthRecords.length} æ¢çœŸå¯¦æª¢é©—è¨˜éŒ„\nğŸ”¬ åŒ…å« ${dataKeys.size} é …æª¢é©—æŒ‡æ¨™\nğŸ“… å¾ 2025-05-18 åˆ° 2025-06-26\nğŸ“Š åŒ…å«6/26æœ€æ–°æª¢é©—çµæœ\nğŸ’¡ æ•¸æ“šç›´æ¥å¾ç‘é‡‘é†«é™¢å ±å‘Šè§£æ`);
        }
        
        function clearAllData() {
            if (confirm('âš ï¸ è­¦å‘Šï¼šé€™å°‡åˆªé™¤æ‰€æœ‰å¥åº·è¨˜éŒ„æ•¸æ“šï¼\n\næ­¤æ“ä½œä¸å¯æ¢å¾©ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                if (confirm('æœ€å¾Œç¢ºèªï¼šçœŸçš„è¦åˆªé™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿå»ºè­°å…ˆå°å‡ºå‚™ä»½ï¼')) {
                    healthRecords = [];
                    localStorage.removeItem('healthRecords');
                    displayRecords();
                    alert('æ‰€æœ‰æ•¸æ“šå·²æ¸…ç©ºï¼');
                }
            }
        }
        
        function backupData() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const backupData = {
                timestamp: timestamp,
                records: healthRecords,
                version: '2.0',
                recordCount: healthRecords.length,
                dateRange: healthRecords.length > 0 ? {
                    earliest: healthRecords[healthRecords.length - 1].date,
                    latest: healthRecords[0].date
                } : null
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `å¥¶å¥¶å¥åº·è¨˜éŒ„å‚™ä»½_${timestamp.split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('æ•¸æ“šå‚™ä»½å·²å‰µå»ºï¼');
        }
        
        // é é¢åŠ è¼‰æ™‚çš„è™•ç†
        window.onload = function() {
            console.log('=== å¥¶å¥¶å¥åº·è¨˜éŒ„ç³»çµ± - æœ€çµ‚ä¿®å¾©ç‰ˆ ===');
            
            // å¼·åˆ¶é‡æ–°åŠ è¼‰æ•¸æ“š
            localStorage.removeItem('healthRecords');
            healthRecords = preloadedHealthRecords.slice();
            localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
            
            console.log('å¥åº·è¨˜éŒ„ç¸½æ•¸:', healthRecords.length);
            console.log('é…ç½®çš„æª¢é©—é …ç›®ç¸½æ•¸:', Object.keys(testConfigs).length);
            
            // æª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§
            const dataKeys = new Set();
            healthRecords.forEach(record => {
                Object.keys(record).forEach(key => {
                    if (key !== 'date' && key !== 'notes' && testConfigs[key]) {
                        dataKeys.add(key);
                    }
                });
            });
            
            console.log('å¯¦éš›åŒ…å«çš„æª¢é©—é …ç›®æ•¸é‡:', dataKeys.size);
            console.log('æª¢é©—é …ç›®åˆ—è¡¨:', Array.from(dataKeys).sort());
            
            // åˆå§‹åŒ–åœ–è¡¨
            initializeChart();
            
            // é¡¯ç¤ºæ­¡è¿æ¶ˆæ¯
            setTimeout(() => {
                if (healthRecords.length > 0) {
                    const earliestDate = healthRecords[healthRecords.length - 1].date;
                    const latestDate = healthRecords[0].date;
                    
                    alert(`ğŸ¥ å¥¶å¥¶å®Œæ•´å¥åº·è¨˜éŒ„ç³»çµ± - ä¿®å¾©ç‰ˆå·²å°±ç·’ï¼

âœ… å·²æˆåŠŸè¼‰å…¥ ${healthRecords.length} æ¢å®Œæ•´æª¢é©—è¨˜éŒ„
ğŸ“… è¨˜éŒ„æ™‚é–“ï¼š${earliestDate} è‡³ ${latestDate}
ğŸ”¬ åŒ…å« ${dataKeys.size} é …æª¢é©—æŒ‡æ¨™æ•¸æ“š

ğŸ‰ ç³»çµ±åŠŸèƒ½å®Œæ•´ï¼š
â€¢ âœ… å…¨é¢çš„æª¢é©—æ•¸æ“šï¼ˆ47é …æŒ‡æ¨™ï¼‰
â€¢ âœ… å®Œæ•´çš„åœ–è¡¨åˆ†æï¼ˆæŸ±ç‹€åœ–å’ŒæŠ˜ç·šåœ–ï¼‰
â€¢ âœ… è©³ç´°çš„æ­·å²è¨˜éŒ„æŸ¥çœ‹
â€¢ âœ… å¼·å¤§çš„æ•¸æ“šå°å‡ºåŠŸèƒ½
â€¢ âœ… å¥åº·ç‹€æ³ç¸½è¦½å’Œè¶¨å‹¢åˆ†æ

ğŸ“Š ç¾åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ï¼`);
                }
            }, 1000);
            
            // åˆå§‹åŒ–ç¬¬ä¸€å€‹åœ–è¡¨
            updateChart();
        };
    </script>
</body>
</html>